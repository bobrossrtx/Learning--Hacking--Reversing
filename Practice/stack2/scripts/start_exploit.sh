#!/bin/bash

ENV=$GREENIE
FILE="/opt/protostar/bin/stack2"
EXPLOIT="/tmp/exploit.py"
EXPLOITOUT="/tmp/exp"
PYTHON="/usr/bin/python"

if [[ $ENV ]];then
  echo "GREENIE already exists"
else
  echo "GREENIE doesn't exist"
  echo "Creating GREENIE";
  if [[ -f $EXPLOIT ]]; then
    if [[ -f $PYTHON ]]; then
      $PYTHON $EXPLOIT > $OUT
    else
      echo "Missing python"
      exit 1
    fi
  else
    echo "$EXPLOIT Does not exist"
    exit 1
  fi

  export GREENIE=$(cat $EXPLOITOUT)

  if [[ -f $FILE ]]; then
    $FILE
  else
    echo "$FILE Does not exist"
    exit 1
  fi
fi