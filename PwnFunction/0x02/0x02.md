# Wont_Close - File Descriptors
## Owen Boreham
## 05/03/2021 (MM/DD/YYYY)

### Source
```c
#include <stdio.h>
#include <fcntl.h>
#include <unistd.h>

int main () {
    int file_descriptor;
    file_descriptor = open("/etc/shadow", 0);

    setuid(getuid()); // drop privileges

    char *args[] = {"sh", 0};
    execvp("/bin/sh", args);
    return 0;
}
```

```make
all:
 gcc -o wont_close wont_close.c && chmod u+s wont_close
```

Right, we are given a setuid binary that drops the privileges down to the user. So if we execute the program, we are put into a bash shell, but, the file_descriptor is still open. So say we open a program that opens another file that it has permision to open and read, but a file that you don't want others seeing, people will be able to read the file from /proc/{process id}/fd

Lets try executing the program using `./wont_close`
This opens us into a shell prompt. We will then cd into `/proc/self/`

```bash
$ cd /proc/self
$ ls
arch_status      cpuset   loginuid    numa_maps      sched         status
attr             cwd      map_files   oom_adj        schedstat     syscall
autogroup        environ  maps        oom_score      sessionid     task
auxv             exe      mem         oom_score_adj  setgroups     timens_offsets
cgroup           fd       mountinfo   pagemap        smaps         timers
clear_refs       fdinfo   mounts      patch_state    smaps_rollup  timerslack_ns
cmdline          gid_map  mountstats  personality    stack         uid_map
comm             io       net         projid_map     stat          wchan
coredump_filter  limits   ns          root           statm
```

We can now see the fd directory inside of `/proc/self`. Lets cd into that directory and see whats inside, `cd fd`

```bash
$ ls -l
total 0
lrwx------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 0 -> /dev/pts/3
lrwx------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 1 -> /dev/pts/3
lrwx------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 10 -> /dev/tty
lrwx------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 2 -> /dev/pts/3
lr-x------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 20 -> /snap/code/62/usr/share/code/v8_context_snapshot.bin
lrwx------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 24 -> 'socket:[38214]'
lr-x------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 3 -> /etc/passwd
lr-x------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 31 -> /proc/2933/statm
lr-x------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 32 -> /proc/2933/status
lrwx------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 33 -> '/tmp/.org.chromium.Chromium.qoXN2e (deleted)'
lrwx------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 34 -> 'socket:[38224]'
lr-x------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 40 -> /snap/code/62/usr/share/code/resources/app/node_modules.asar
lr-x------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 41 -> /snap/code/62/usr/share/code/resources/app/node_modules.asar
lr-x------ 1 bobrossrtx bobrossrtx 64 May  3 18:48 42 -> /usr/share/fonts/truetype/liberation/LiberationSerif-Regular.ttf
```

And right there, on the 7th line, /etc/passwd. Even though /etc/passwd is publicly readable, think of it as if it was a private document that you didn't want people to read.
